<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Early last week, Denis from Kaspersky had blogged about a new Zitmo (Zeus in the Mobile) variant which was affecting both Android and Blackberry. After some digging I was finally able to turn up a sam">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Zitmo Analysis: Now you see me, now you don&#39;t">
<meta property="og:url" content="https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/index.html">
<meta property="og:site_name" content="Strazzere">
<meta property="og:description" content="Early last week, Denis from Kaspersky had blogged about a new Zitmo (Zeus in the Mobile) variant which was affecting both Android and Blackberry. After some digging I was finally able to turn up a sam">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.strazzere.com/blog/wp-content/uploads/2012/08/onCreate.png">
<meta property="og:image" content="http://www.strazzere.com/blog/wp-content/uploads/2012/08/sendInintSms1.png">
<meta property="og:image" content="http://www.strazzere.com/blog/wp-content/uploads/2012/08/ActionReceiver.png">
<meta property="article:published_time" content="2012-08-14T05:46:09.000Z">
<meta property="article:modified_time" content="2024-06-18T21:20:59.087Z">
<meta property="article:author" content="Tim Strazzere">
<meta property="article:tag" content="android">
<meta property="article:tag" content="reverse engineering">
<meta property="article:tag" content="DONT_KILL_APP">
<meta property="article:tag" content="malware">
<meta property="article:tag" content="setComponentEnabledSetting">
<meta property="article:tag" content="zeus">
<meta property="article:tag" content="zitmo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.strazzere.com/blog/wp-content/uploads/2012/08/onCreate.png">
<meta name="twitter:creator" content="@timstrazz">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/6a4b43066d19111e850cb14b45eacf93?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/6a4b43066d19111e850cb14b45eacf93?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/6a4b43066d19111e850cb14b45eacf93?s=180">
          
        
      
    
    <!-- title -->
    <title>Android Zitmo Analysis: Now you see me, now you don&#39;t</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166943540-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-166943540-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="Strazzere" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/strazzere">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2013/02/javascript-malware-cross-contamination-in-android-apks/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2012/08/dexploration-what-a-default-dex-looks-like/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&text=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&is_video=false&description=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android Zitmo Analysis: Now you see me, now you don&#39;t&body=Check out this article: https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&name=Android Zitmo Analysis: Now you see me, now you don&#39;t&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&t=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Android Zitmo Analysis: Now you see me, now you don&#39;t
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Tim Strazzere</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2012-08-14T05:46:09.000Z" class="dt-published" itemprop="datePublished">2012-08-13</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/android/">android</a> › <a class="category-link" href="/categories/android/reverse-engineering/">reverse engineering</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/DONT-KILL-APP/" rel="tag">DONT_KILL_APP</a>, <a class="p-category" href="/tags/android/" rel="tag">android</a>, <a class="p-category" href="/tags/malware/" rel="tag">malware</a>, <a class="p-category" href="/tags/reverse-engineering/" rel="tag">reverse engineering</a>, <a class="p-category" href="/tags/setComponentEnabledSetting/" rel="tag">setComponentEnabledSetting</a>, <a class="p-category" href="/tags/zeus/" rel="tag">zeus</a>, <a class="p-category" href="/tags/zitmo/" rel="tag">zitmo</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>Early last week, Denis from Kaspersky had <a target="_blank" rel="noopener" href="https://www.securelist.com/en/blog/208193760/New_ZitMo_for_Android_and_Blackberry">blogged</a> about a new Zitmo (Zeus in the Mobile) variant which was affecting both Android and Blackberry. After some digging I was finally able to turn up a sample for analysis. Originally I figured it would be the same old sample as before, wouldn’t do much and not be very sophisticated at all. Turns out I was half right, most of it was identical to previous samples - though I did learn new little trick from the malware this time around.</p>
<p>After I did a tear down I submitted a sample to Mila over at the <a target="_blank" rel="noopener" href="http://contagiominidump.blogspot.com/">Contagio Mobile Dump</a>, so if you’d like to follow along the sample I was dissecting you can find it <a target="_blank" rel="noopener" href="http://contagiominidump.blogspot.com/2012/08/new-zitmo-for-android-and-blackberry.html">here</a>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Filename: zitmo.apk</span><br><span class="line">SHA256: 40286c6091c5a2d575702b1d88eaa94aa8eba524</span><br><span class="line">MD5: e98791dffcc0a8579ae875149e3c8e5e</span><br></pre></td></tr></table></figure>

<p>Firing up our trusty keytool, we can see what the certificate is - try to get an estimated date when this file was created;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">champagne:zitmo-sample tstrazzere$ printcert contents/META-INF/*.RSA</span><br><span class="line">Owner: CN=Android Debug, O=Android, C=US</span><br><span class="line">Issuer: CN=Android Debug, O=Android, C=US</span><br><span class="line">Serial number: 5007c89d</span><br><span class="line">Valid from: Thu Jul 19 01:43:09 PDT 2012 until: Sat Jul 12 01:43:09 PDT 2042</span><br><span class="line">Certificate fingerprints:</span><br><span class="line">	 MD5:  A5:D9:08:26:EC:E0:74:4F:E8:89:35:53:F0:6E:28:55</span><br><span class="line">	 SHA1: B3:23:BD:C7:A3:24:9F:C1:8E:85:44:A8:ED:09:2C:3A:41:3D:23:80</span><br><span class="line">	 Signature algorithm name: SHA1withRSA</span><br><span class="line">	 Version: 3</span><br><span class="line">champagne:zitmo-sample tstrazzere$ ls -l contents/META-INF/*</span><br><span class="line">-rw-r--r--@ 1 tstrazzere 776B Jul 24 07:12 contents/META-INF/CERT.RSA</span><br><span class="line">-rw-r--r--@ 1 tstrazzere 1.1K Jul 24 07:12 contents/META-INF/CERT.SF</span><br><span class="line">-rw-r--r--@ 1 tstrazzere 1.0K Jul 24 07:12 contents/META-INF/MANIFEST.MF</span><br></pre></td></tr></table></figure>


<p>So, assuming that the malware author hasn’t been messing around with timestamps, we can assume that the malware was created before or on July 24 of this year - and signed on that day as well. As a sanity check, the Android debug certificate validates this, since it was created before this date. This is in no way concrete that it was actually build&#x2F;signed on that day - but it does give us a decent idea of the timeframe.</p>
<p>The next piece of interest lays within the AndroidManifest.xml - let’s see how the author intends this application to be started;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;manifest</span><br><span class="line"> xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line"> android:versionCode=&quot;1&quot;</span><br><span class="line"> android:versionName=&quot;1.0&quot;</span><br><span class="line"> android:installLocation=&quot;1&quot;</span><br><span class="line"> package=&quot;com.security.service&quot;&gt;</span><br><span class="line"> &lt;uses-permission</span><br><span class="line">  android:name=&quot;android.permission.RECEIVE_SMS&quot;&gt;</span><br><span class="line">  &lt;/uses-permission&gt;</span><br><span class="line"> &lt;uses-permission</span><br><span class="line">  android:name=&quot;android.permission.SEND_SMS&quot;&gt;</span><br><span class="line">  &lt;/uses-permission&gt;</span><br><span class="line"> &lt;uses-sdk</span><br><span class="line">  android:minSdkVersion=&quot;4&quot;</span><br><span class="line">  android:targetSdkVersion=&quot;16&quot;&gt;</span><br><span class="line">  &lt;/uses-sdk&gt;</span><br><span class="line">  &lt;application</span><br><span class="line">   android:theme=&quot;@7F060000&quot;</span><br><span class="line">   android:label=&quot;@7F050000&quot;</span><br><span class="line">   android:icon=&quot;@7F020001&quot;</span><br><span class="line">   android:debuggable=&quot;true&quot;&gt;</span><br><span class="line">  &lt;activity</span><br><span class="line">   android:theme=&quot;@7F060001&quot;</span><br><span class="line">   android:name=&quot;com.security.service.MainActivity&quot;&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">     &lt;category</span><br><span class="line">      android:name=&quot;android.intent.category.LAUNCHER&quot;&gt;</span><br><span class="line">     &lt;/category&gt;</span><br><span class="line">     &lt;action</span><br><span class="line">      android:name=&quot;android.intent.action.MAIN&quot;&gt;</span><br><span class="line">     &lt;/action&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">   &lt;/activity&gt;</span><br><span class="line">   &lt;receiver</span><br><span class="line">    android:name=&quot;com.security.service.receiver.ActionReceiver&quot;</span><br><span class="line">    android:permission=&quot;android.permission.RECEIVE\_BOOT\_COMPLETED&quot;</span><br><span class="line">    android:enabled=&quot;true&quot;&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">     &lt;category</span><br><span class="line">      android:name=&quot;android.intent.category.HOME&quot;&gt;</span><br><span class="line">     &lt;/category&gt;</span><br><span class="line">     &lt;action</span><br><span class="line">      android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;&gt;</span><br><span class="line">     &lt;/action&gt;</span><br><span class="line">     &lt;action</span><br><span class="line">      android:name=&quot;android.intent.action.USER_PRESENT&quot;&gt;</span><br><span class="line">     &lt;/action&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">   &lt;/receiver&gt;</span><br><span class="line">   &lt;receiver</span><br><span class="line">    android:name=&quot;com.security.service.receiver.SmsReceiver&quot;</span><br><span class="line">    android:enabled=&quot;true&quot;&gt;</span><br><span class="line">    &lt;intent-filter</span><br><span class="line">     android:priority=&quot;2147483647&quot;&gt;</span><br><span class="line">    &lt;action</span><br><span class="line">      android:name=&quot;android.provider.Telephony.SMS_RECEIVED&quot;&gt;</span><br><span class="line">     &lt;/action&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">   &lt;/receiver&gt;</span><br><span class="line">   &lt;receiver</span><br><span class="line">    android:name=&quot;com.security.service.receiver.RebootReceiver&quot;</span><br><span class="line">    android:permission=&quot;android.permission.REBOOT&quot;</span><br><span class="line">    android:enabled=&quot;true&quot;&gt;</span><br><span class="line">     &lt;intent-filter&gt;</span><br><span class="line">     &lt;action</span><br><span class="line">      android:name=&quot;android.intent.action.REBOOT&quot;&gt;</span><br><span class="line">     &lt;/action&gt;</span><br><span class="line">     &lt;action</span><br><span class="line">       android:name=&quot;android.intent.action.ACTION_SHUTDOWN&quot;&gt;</span><br><span class="line">     &lt;/action&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">   &lt;/receiver&gt;</span><br><span class="line">  &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>

<p>According the <code>AndroidManifest</code> above we can see the application has four main entry points;</p>
<ul>
<li><code>MainActivity</code> - launched as the main activity, which should be visible by the launcher&#x2F;tray</li>
<li><code>ActionReceiver</code> - launched when the <code>HOME</code>, <code>BOOT_COMPLETED</code> or <code>USER_PRESENT</code> intent is fired by the system</li>
<li><code>SmsReceiver</code> - launched when the <code>SMS_RECEIVED</code> intent is fired, with a priority of <code>Integer.MAX_VALUE</code></li>
<li><code>RebootReceiver</code> - launched when the <code>REBOOT</code> or <code>ACTION_SHUTDOWN</code> intent is fired</li>
</ul>
<p>This seemed like a bit to many receivers right off the bat, it seems odd that there is a reboot receiver - though maybe the author was trying to more than just intercept SMS messages? Let’s first dig into the code and see how the malware is looking to get started. Loading up IDA Pro and a terminal with baksmali, there is something we can notice right off away, the authors where using the latest Android SDK - there is a ton of support code in the <code>android/support</code> directory used for backwards compatibility. It’s actually a bit funny as there is more code in those files than the malware itself!</p>
<p>Looking at the <code>MainActivity</code> default create method, we can see the only code which a user might actually see when the malware is launched;<br><img src="http://www.strazzere.com/blog/wp-content/uploads/2012/08/onCreate.png" alt="MainActivity.onCreate" title="MainActivity.onCreate"></p>
<p>Essentially the bulk of the of the code is just checking a <code>PersistenceManager</code> object, which is just a wrapper for the normal Android <code>SharedPreference</code> object. This checks to see if the application has been run or not before. If the application has not been run, it will mark the first run as having occurred - followed by running the <code>SmsReceiver.sendInintSms()</code> function. This function, pictured below, gets the default admin number (+46769436094) and sends it the message “INOK”.<br><img src="http://www.strazzere.com/blog/wp-content/uploads/2012/08/sendInintSms1.png" alt="SmsReceiver.sendInintSms()" title="SmsReceiver.sendInintSms()"></p>
<p>The next receiver to look at is the <code>ActionReceiver</code>. This is also very simple - essentially if the intent is either <code>BOOT_COMPLETED</code> or <code>USER_PRESENT</code> then it will attempt to kick of the <code>MainActivity</code>, which would cause the code above to be launched. This is also gated by the same <code>isFirstLaunch</code> function from the <code>PersistenceManager</code> class. The cleaned up code for this receiver is below, pretty self explanatory as well;<br><img src="http://www.strazzere.com/blog/wp-content/uploads/2012/08/ActionReceiver.png" alt="ActionReceiver.onReceiver(...)" title="ActionReceiver.onReceiver(...)"></p>
<p>The main functionality of the malware is located where it has been for the last few Zitmo samples, inside the <code>SmsReceiver</code>. The <code>onReceive</code> method essentially houses a large switch statement which will allow the following commands to be parsed;</p>
<ul>
<li><code>on</code> - replies “ONOK” if sent from admin #, then sets the sms interceptor on</li>
<li><code>off</code> - replies “OFOK” if sent from admin #, then sets the sms interceptor off</li>
<li><code>set admin</code> - replies “SAOK” if sent from admin #, then sets a new admin # to user</li>
</ul>
<p>All of the commands above will have their broadcast aborted, so no other application should receive the SMS message. If any other SMS is received other than the commands above the code follows a simple path. It will abort the broadcast aborted and the message sent to the admin number in the format of: “message ${SMS_BODY}, F: ${SMS_SENDER}”. These basic commands, combined with the a PC infected with Zeus, is enough for the authors to programmatically intercept mTans for what would appear to be German bank users. So what, right? I said there was something interesting about this malware - yet everything described has been old stuff. Well the interesting part for me happened when I looked at the last receiver, which didn’t seem like it would be necessary. The malware already has all the code it needs to function as normal, right? Well - it actually is going to attempt to hide itself from the user on a reboot. If we look back at the <code>AndroidManifest.xml</code> we can see the activity tag which lets the application appear in the launcher&#x2F;tray of the device;</p>
<p>Previously, we’ve seen malware that avoids putting this into the manifest, trying to hide from the user. In this case, the malware does want to be found and hopefully executed by the user. The trick is, they only want this to be visible to the user for one boot. If we take a look at the <code>RebootReceiver.onReceive</code> function, we can see a simple code path that checks for the <code>REBOOT</code> or <code>ACTION_SHUTDOWN</code> intents. If either is caught by their receiver, it will call the <code>MainActivity.hideIcon()</code> function. The pseudo code for this function is as follows;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static void hideIcon(Context context) &#123;</span><br><span class="line">    PackageManager packageManager = context.getPackageManager();</span><br><span class="line">    packageManager.setComponentEnabledSetting(</span><br><span class="line">      new ComponentName(&quot;com.security.service&quot;,</span><br><span class="line">        &quot;com.security.service.MainActivity&quot;),</span><br><span class="line">      COMPONENT_ENABLED_STATE_DISABLED,</span><br><span class="line">      DONT_KILL_APP);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This code will dynamically remove the receiver component, even though it is still set within the <code>AndroidManifest.xml</code>. This means on reboot, the icon will no longer be present inside the launch&#x2F;tray of the device, but the other receivers should still remain active. While this isn’t rocket science - mainly just understand the Android APIs, it’s something I’ve never seen any malware do. Performing a few Google searches, it doesn’t seem to be something widely used or deployed in practice. I did perform a few searches though for applications that did this and found a few that used this to be “less annoying” to a user and hide when they where not wanted. This is also recommended for something like an option <code>BOOT_COMPLETE</code> intent, such as an option service that a user might not want from an application.</p>
<p><em>TL;DR</em> - You can dynamically disable you competent in your Android application, effectively “hiding” yourself from a users launcher&#x2F;tray.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/strazzere">Projects</a></li>
        
      </ul>
    </div>

    
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&text=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&is_video=false&description=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Android Zitmo Analysis: Now you see me, now you don&#39;t&body=Check out this article: https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&title=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&name=Android Zitmo Analysis: Now you see me, now you don&#39;t&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://strazzere.com/2012/08/android-zitmo-analysis-now-you-see-my-now-you-dont/&t=Android Zitmo Analysis: Now you see me, now you don&#39;t"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2008-2024
    Tim Strazzere
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/strazzere">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
